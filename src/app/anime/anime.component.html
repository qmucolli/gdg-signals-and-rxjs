<div class="container">
  <div class="search-container">
    <input
      type="text"
      placeholder="Search for an anime (e.g., 'One Piece')"
      #searchInput
      (input)="onSearch(searchInput.value)"
    />
  </div>

  @if (searchTerm(); as searchTermValue) {
    <div class="results-section">
      <h2>Search Results for "{{ searchTermValue }}"</h2>
      @if (searchResults(); as searchResults) {
        @if (searchResults.length > 0) {
          <div class="anime-grid">
            @for (anime of searchResults; track anime.mal_id) {
              <div class="anime-card" (click)="selectAnime(anime)">
                <img [src]="anime.images.webp.large_image_url" [alt]="anime.title"/>
                <h3>{{ anime.title }}</h3>
                <div class="score">‚≠ê {{ anime.score }}</div>
              </div>
            }
          </div>
        } @else {
          <p class="status-message">No results found.</p>
        }
      }
    </div>
  } @else {
    <div class="top-anime-section">
      <h1>Top Anime Series</h1>

      @if (animeList(); as animeList) {
        @switch (animeList) {
          @case (undefined) {
            <p class="loading">Loading anime...</p>
          }
          @case (null) {
            <p class="error">Failed to load anime. Please try again later.</p>
          }
          @default {
            <div class="anime-grid">
              @for (anime of animeList; track anime.mal_id) {
                <div class="anime-card" (click)="selectAnime(anime)">
                  <img [src]="anime.images.webp.large_image_url" [alt]="anime.title">
                  <h3>{{ anime.title }}</h3>
                </div>
              }
            </div>
          }
        }
      }
    </div>
  }
</div>

@if (selectedAnime(); as selectedAnime) {
  <app-anime-detail
    [anime]="selectedAnime"
    (close)="clearSelectedAnime()"
  />
}
